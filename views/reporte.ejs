<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Directorio</title>
  <link rel="stylesheet" href="/css/output.css"/>

  <style> 

    body {
      background-color: #E4E8EE;
    }

    #container {
      position: relative;
      height:500px;
      box-shadow: 1px 4px 8px rgba(36, 37, 42, 0.2);
    }
    #containerElements {
      overflow-y: auto; 
      height:100%;
    }
    #element {
      position: relative;
    }
    #main-content {
      transition: padding-left 0.3s ease;
      padding-left: 3.5rem;
    } 
    .side:hover ~ #main-content {
      padding-left: 10rem;
    }

  </style>


  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <%- include('partials/sidebar.ejs') %> 

    <div id="main-content" class="w-full ml-14 mt-12 pl-20 display:flex">
        <h1 class="mb-8 text-4xl text-gray-900">Hi</h1>
    </div>

    <button onclick="graficas_asincronas('<%= graphs[0] %>')">Generar Gr√°ficas</button>

    <canvas id="graphOne" width="400" height="200" ></canvas>
    
   

</body>

<script defer>

const graficas_asincronas = (idGraph) => {

        fetch(`/reporte/${idGraph}`, {
        method: 'GET', 
        headers: {
          'Content-Type': 'application/json',
        }
    }).then((result) => {
        if (!result.ok) {
            throw new Error('Network response was not ok');
        }
        return result.json();
    })
    .then((data) => {
      
      Object.keys(data).forEach((key) => {

        const graphData = data[key];

        if (key === 'graph1Data') {

          const leadsPorDia = {};
          let diasTot = 0;
          let leadsTot = 0;

          graphData.forEach((item) => {
            
            const fecha = item.Fecha;
            const leads = item.Leads;
            if (!leadsPorDia[fecha]) {
              leadsPorDia[fecha] = leads;
              diasTot++;              
            } else {
              leadsPorDia[fecha] += leads;
            }
            leadsTot += leads;

          });

          const promLeadsPorDia = leadsTot / diasTot;

          // Chart JS
          const fechas = Object.keys(leadsPorDia);
          const leads = Object.keys(leadsPorDia);

          const canvas_1 = document
            .getElementById('graphOne')
            .getContext('2D');

          const graficaUno = new Chart(canvas_1, {
            type: 'bar',
            data: {
              labels: fechas,

              datasets: [
                {
                  label: 'Promedio de Leads manejados al dia',
                  data: leads,
                  backgroundColor: 'rgba(54, 162, 235, 0.2)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        }
      });
    });

}

</script>

</html>